# Entity Framework Core in .NET 8.0

https://unitcoding.com/ef-core-relationships/

https://medium.com/c-sharp-programming/relationships-in-entity-framework-core-6bea347a51e4

https://github.com/Osempu/BlogAPI

https://github.com/Osempu/BlogAPI/tree/SerilogLogging

https://github.com/Osempu/BlogAPI/tree/FluentValidation


# Samples

## Update your Database 
```
dotnet ef migrations add "Added new entities and applied relationships"
dotnet ef database update
```

## DTOs
```
public record AddPostDTO(string Title, string Body, int AuthorId);
public record EditPostDTO(int Id, string Title, string Body, int AuthorId);
```

## Configure the Entities Relationships
```
  public class PostConfiguration : IEntityTypeConfiguration<Post>
  {
      public void Configure(EntityTypeBuilder<Post> builder)
      {
          builder.HasOne( p => p.Author)
              .WithMany( a => a.Posts)
              .HasForeignKey( p => p.AuthorId);
          builder.HasMany( p => p.Tags)
              .WithMany( t => t.Posts)
              .UsingEntity( j => j.ToTable("PostTag"));
					//Data seeding ** this is not used for relationship configuration **
          builder.HasData(
              new Post {Id = 1, Author = new Author {Id = 1, Name = "Oscar Montenegro"}, Title = "My first Post", Body = "Hello world, this is my first post"},
              new Post {Id = 2, Author = new Author {Id = 2, Name = "Another Author"}, Title = "My second Post", Body = "Hello world, this is my second post"}
          );
      }
   }
```

## Update Post model
```
public class Post
{
    public int Id { get; set; }
    public string Title { get; set; }
    public string Body { get; set; }
    public DateTime CreatedDate { get; set; }
    public DateTime LastUpdated { get; set; }
    public int AuthorId { get; set; }
    public Author Author { get; set; }
    public ICollection<Tag> Tags { get; set; }
}
```

## Tag model
```
public class Tag
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Description { get; set; }
    public ICollection<Post> Posts { get; set; }
}
```

# Configurations in Entity Framework Core

## By Convention
```
// Entities
public class Person
{
    public int PersonId { get; set; }
    public string Name { get; set; }
    public Address Address { get; set; }
}
public class Address
{
    public int AddressId { get; set; }
    public string City { get; set; }
    public Person Person { get; set; }
}
```

## Data Annotations
```
// Entities
public class Person
{
    public int PersonId { get; set; }
    public string Name { get; set; }
    [ForeignKey("Address")]
    public int AddressId { get; set; }
    public Address Address { get; set; }
}
public class Address
{
    [Key, ForeignKey("Person")]
    public int AddressId { get; set; }
    public string City { get; set; }
    public Person Person { get; set; }
}
```

Entity Framework Core provides several data annotations that you can use to configure entities and their relationships. These data annotations can be applied to entity classes and properties to specify various aspects of the configuration. Here are some commonly used data annotations for entity configuration:

+ **[Key]**: Specifies the primary key property of an entity. By default, Entity Framework Core assumes that a property named "Id" or "<EntityName>Id" is the primary key, but you can use this annotation to explicitly designate a property as the primary key.
+ **[ForeignKey]**: Specifies the foreign key property in a relationship. This annotation is used to define the foreign key column that relates to another entity.
+ **[Required]**: Indicates that a property is required and cannot be null. This annotation ensures that the corresponding column in the database is configured as non-nullable.
+ **[MaxLength]**: Sets the maximum length or size for a string or byte array property. It can be used to limit the length of a string column in the database.
+ **[Column]**: Specifies the name of the column in the database associated with a property. This annotation allows you to define custom column names.
+ **[Table]**: Specifies the table name for an entity in the database. It can be used to override the default table name generated by Entity Framework Core.
+ **[NotMapped]**: Excludes a property from being mapped to a column in the database. This annotation is useful when you have properties in your entity that don't have corresponding columns in the database.
+ **[InverseProperty]**: Specifies the inverse navigation property for a relationship. It is used when you have multiple navigation properties between two entities and need to specify the inverse relationship explicitly.
+ **[Index]**: Indicates that an index should be created on one or more columns in the database. This annotation can improve query performance by optimizing data retrieval.

## Fluent API
```
// Entities
public class Person
{
    public int PersonId { get; set; }
    public string Name { get; set; }
    public Address Address { get; set; }
}
public class Address
{
    public int AddressId { get; set; }
    public string City { get; set; }
    public Person Person { get; set; }
}
// Configuration
public class MyContext : DbContext
{
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Person>()
            .HasOne(p => p.Address)
            .WithOne(a => a.Person)
            .HasForeignKey<Address>(a => a.AddressId);
    }
}
```

## One-to-One Relationship
```
// Entities
public class Person
{
    public int PersonId { get; set; }
    public string Name { get; set; }
    public Passport Passport { get; set; }
}
public class Passport
{
    public int PassportId { get; set; }
    public string City { get; set; }
    public Person Person { get; set; }
}
// Configuration
public class MyContext : DbContext
{
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Person>()
            .HasOne(p => p.Passport)
            .WithOne(a => a.Person)
            .HasForeignKey<Passport>(a => a.PassportId);
    }
}
```

## One-to-Many Relationship
```
// Entities
public class Book
{
    public int BookId { get; set; }
    public string Name { get; set; }
    public ICollection<Review> Reviews { get; set; }
}
public class Review
{
    public int ReviewId { get; set; }
    public string Reviewer { get; set; }
    public Book Book { get; set; }
}
// Configuration
public class MyContext : DbContext
{
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Review>()
            .HasOne(r => r.Book)
            .WithMany(b => b.Reviews)
            .HasForeignKey(r => r.BookId);
    }
}
```

## Many-to-Many Relationship
```
// Entities
public class Student
{
    public int StudentId { get; set; }
    public string Name { get; set; }
    public ICollection<Course> Courses { get; set; }
}
public class Course
{
    public int CourseId { get; set; }
    public string Name { get; set; }
    public ICollection<Student> Students { get; set; }
}
// Configuration
public class MyContext : DbContext
{
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Student>()
            .HasMany(s => s.Courses)
            .WithMany(c => c.Students)
            .UsingEntity(j => j.ToTable("StudentCourse"));
    }
}
```
